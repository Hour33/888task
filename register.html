<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Register | Hour33</title>
<style>
body { font-family: Arial,sans-serif; background: #fff; margin:0; display:flex; flex-direction:column; align-items:center; }
.banner { width:100%; max-width:500px; margin-top:20px; }
.banner img { width:100%; border-radius:12px; display:block; }
.card { background:#fff; padding:25px; border-radius:20px; box-shadow:0 6px 18px rgba(0,0,0,0.1); width:90%; max-width:400px; margin-top:-25px; text-align:center; border:1px solid #ccc; }
input { width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #ccc; outline:none; box-sizing:border-box; }
button { width:100%; padding:12px; background:#4caf50; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin-top:10px; }
button:hover { background:#43a047; }
.password-warning { font-size:12px;color:red;margin-top:-5px; display:none; }
a { color:#1e88e5;text-decoration:none;font-weight:bold; }
#msg { margin-top:10px; font-size:14px; }
</style>
</head>
<body>

<div class="banner">
  <img src="https://i.postimg.cc/Pq66mhjL/file-00000000848c71f4aefb45586e4fb843.png" alt="Register Banner">
</div>

<div class="card">
  <h2>Create Account</h2>
  <input id="phone" type="text" placeholder="Account" />
  <input id="password" type="password" placeholder="Password" />
  <div id="pwWarning" class="password-warning">Can't use that figure already tried too many times</div>
  <input id="confirmPassword" type="password" placeholder="Confirm Password" />
  <input type="text" value="30Q4782N" readonly />
  <button id="registerBtn" type="button">Register</button>
  <p>Already have an account? <a href="login.html">Login</a></p>
  <div id="msg"></div>
</div>

<!-- Supabase JS CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
const supabaseUrl = 'https://oetyaatagxshgtzdjidn.supabase.co';
const supabaseKey = 'sb_publishable_knnuabKcZ6p4DF4CrEwWAw_zg2mc1Wa';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const blockedPasswords = ["123456","moyin123","moyin1234","moyin12","difficult","difficulty","difficultydifficult"];
const pwInput = document.getElementById("password");
const pwWarning = document.getElementById("pwWarning");

pwInput.addEventListener("input", () => {
  pwWarning.style.display = blockedPasswords.includes(pwInput.value.toLowerCase()) ? "block":"none";
});

document.getElementById("registerBtn").addEventListener("click", async () => {
  const phone = document.getElementById("phone").value.trim();
  const password = pwInput.value.trim();
  const confirmPassword = document.getElementById("confirmPassword").value.trim();
  const msg = document.getElementById("msg");
  msg.textContent = "";

  if (!phone || !password || !confirmPassword) {
    msg.style.color="red"; msg.textContent="Please fill all fields"; return;
  }
  if (blockedPasswords.includes(password.toLowerCase())) {
    msg.style.color="red"; msg.textContent="Can't use that figure already tried too many times"; return;
  }
  if (password !== confirmPassword) {
    msg.style.color="red"; msg.textContent="Passwords do not match"; return;
  }

  msg.style.color="#4caf50"; msg.textContent="Registering...";

  // ✅ Check if user exists
  const { data: existingUsers, error: fetchError } = await supabase
    .from('users')
    .select('*')
    .eq('phone', phone);

  if (fetchError) { msg.style.color="red"; msg.textContent="Error: "+fetchError.message; return; }
  if (existingUsers.length > 0) { msg.style.color="red"; msg.textContent="Account already exists"; return; }

  // ✅ Insert new user
  const { data, error } = await supabase
    .from('users')
    .insert([{ phone, password, balance: 200 }]);

  if (error) { msg.style.color="red"; msg.textContent="Registration failed: "+error.message; return; }

  msg.style.color="#4caf50"; msg.textContent="Registered successfully! Redirecting...";
  setTimeout(()=> location.href="login.html", 1000);
});
</script>

</body>
</html>
